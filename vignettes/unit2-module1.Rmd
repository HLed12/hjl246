---
title: "unit2-module1"
author: "Harrison Leduc"
date: "2024-03-11"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{unit2-module1}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(hjl246)
```

## Task 1

```{r}
roads <- st_read(system.file("extdata/roads.geojson", package = "geospaar"))
roads

districts_alb <- read_sf(system.file("extdata/districts.geojson", 
                                 package = "geospaar")) %>% 
  st_transform(x = ., crs = st_crs(roads))
districts_alb

farmers_alb <- read_csv(system.file("extdata/farmer_spatial.csv", package = "geospaar")) %>% 
  distinct(uuid, x, y, season) %>% 
  st_as_sf(x = ., coords = c("x", "y"), crs = 4326) %>%
  st_transform(x = ., crs = st_crs(roads))
farmers_alb

```

## Task 2

```{r, fig.width=6, fig.height=4, fig.align = "center"}
library(sf)
#par(mar = c(0, 0, 0, 0))

plot(districts_alb %>% st_geometry(), col = "grey", graticule = TRUE, axes = TRUE)
plot(roads, add = TRUE, col = "red", lwd = 2) # or pch = 20
plot(farmers_alb, add = TRUE, pch = "+", size = 3, col = "blue")

```

## Task 3

```{r, fig.width=5, fig.height=6, fig.align = "center"}
ggplot() +
  geom_sf(data = districts_alb, fill = "grey") +
  geom_sf(data = roads, col = "red") +
  geom_sf(data = farmers_alb, pch = "+", size = 3, col = "blue") +
  theme_bw()

```


## Task 4

```{r, fig.width=6, fig.height=4, fig.align = "center"}
# use par(mar(0?,0?,1?,0?)) ?? to get the 1 inch marg at top

median_dist <- districts_alb %>% 
  mutate(area = as.numeric(st_area(.))) %>% 
  arrange(.$area) %>% 
  slice(length(.$area) / 2)
median_dist

par(mar = c(0, 0, 1, 0))
plot(districts_alb %>% st_geometry(), col = "grey", graticule = TRUE, axes = TRUE, main = "The median area district")
plot(st_geometry(median_dist), col = "khaki", add = TRUE)


#dmargin#d <- districts_alb %>% 
#   mutate(area = as.numeric(st_area(districts_alb))) %>% 
#  arrange(.$area)
#d[36,] 
#d


```

## Task 5

```{r, fig.width=6, fig.height=4}
tertiles <- function(x) quantile(x, probs = c(0, 0.333, 0.667, 1))
dist_tertiles <- median_dist %>% 
  mutate(acls = cut(area, breaks = tertiles(area), include.lowest = TRUE))
#  group_by(acls) %>% 
#  summarize(mean_area = mean(area))  

median_distp <- median_dist %>% 
  
  
  
closest_20farmers <- farmers_alb %>% 
  filter(season == 1) %>%
  mutate(dist = st_distance(.)) %>% 
  arrange(dist) %>% 
  slice(1:20)
closest_20farmers

plot(districts_alb %>% st_geometry(), col = "grey", graticule = TRUE, axes = TRUE, main = "The median area district")
plot(st_geometry(median_dist), col = "khaki", add = TRUE)
plot(st_geometry(median_distp), fill = "purple", add = TRUE)
plot(st_geometry(farmers_alb), col = "blue", add = TRUE)
plot(st_geometry(closest_20farmers), col = "red", add = TRUE)




```


