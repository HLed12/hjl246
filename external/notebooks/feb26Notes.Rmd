---
title: "feb26Notes"
author: "Harrison Leduc"
date: "2024-02-26"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

A continuation from 'feb21ClassExamples.Rmd'.
```{r}

fs <- here::here(
  dir("external/data", pattern = ".csv", full.names = TRUE)
)
fs

l2 <- lapply(fs, readr::read_csv)

do.call(rbind, l2)
# or can use library(dplyr)
# bind_rows(l2)
# to bind by columns: do.call(cbind, l2) NOT GOOD FOR THIS EXAMPLE
# or bind_cols(l2) # prevents duplicate column names (they are ugly though)

library(readr)
library(dplyr)
l2 <- lapply(fs, function(x) {
  readr::read_csv(x) %>% 
    mutate(grp = gsub("dataset|.csv", "", basename(x))) ### %>% 
  ### mutate(id = 1:nrow)
  # if errors use "dataset|\\.csv". NOTICE IT IS A BAR, not a 1.
  # basename strips directory to give only file name)
  # gsub will substitue one pattern with another. 
})
l2

dat <- bind_rows(l2)
dat
# tidy principle if the values in a column are there own variable. make them
# a column. Pretend grp is "crop_yeild", "wheat_produced", "etc".

library(tidyr)
dat %>% 
  #mutate(id = 1:nrow(.)) %>% 
  pivot_wider(names_from = grp, values_from = v1)

# The approach professor Estes wanted
dat %>% 
  select(-v2) %>% 
  pivot_wider(names_from = grp, values_from = v1)

# Feb 28 --------------------------------------------------------------------

sz <- 100
for(i in 1:3) {
  set.seed(i)
  d <- data.frame(
    id = 1:sz,
    #v1 = sample(2:12, size = sz, replace = TRUE),
    v1 = runif(sz, min = 2, max = 12),
    grp = paste0("g", i)
  ) %>% mutate(v2 = v1 + rnorm(sz, mean = 2, sd = 2)) %>% 
    select(id, v1, v2, grp)
  readr::write_csv(d, file = file.path(tempdir(), paste0("dataset", i, ".csv")))
}

### three #'s mark what was used before we created the pipe
###fs <- list.files(tempdir(), pattern = "dataset.*.csv", full.names = TRUE)
# Old approach: dat <- do.call(rbind, lapply(fs, readr::read_csv))
###dat <- bind_rows(lapply(fs, readr::read_csv))

dat <- list.files(tempdir(), pattern = "dataset.*.csv", full.names = TRUE) %>% 
  lapply(., readr::read_csv) %>% bind_rows()

#### or can do

#list.files(tempdir(), pattern = "dataset.*.csv", full.names = TRUE) %>% 
#  lapply(., readr::read_csv) %>% bind_rows() -> dat
### NOTICE: the dot means whatever is before in the pipelin 

plot(dat$v1, dat$v2)
```

```{r, eval=FALSE}
dat %>% 
  pivot_wider(names_from = grp, values_from = v1:v2)

# negative indexing
dat %>% 
  select(-v1) %>%
  pivot_wider(names_from = grp, values_from = v2)

### selects all variables except for v1 (inverse operation)
#dat %>% 
#  mutate(id, g1, g2, g3) %>%
#  pivot_wider(names_from = grp, values_from = v2)
### or
dat_wide <- dat %>% 
  select(id, v2, grp) %>% 
  pivot_wider(names_from = grp, values_from = v2)
dat_wide
  
dat_wide %>% 
  pivot_longer(g1:g3, names_to = "grp", values_to = "v2") %>% 
  arrange(grp)

# --------------

dat_long <- dat_wide %>% 
  pivot_longer(g1:g3, names_to = "grp", values_to = "v2") %>% 
  arrange(grp)

dat_long2 <- dat_wide %>% 
  pivot_longer(g1:g3, names_to = "grp", values_to = "v2")

cbind(dat, dat_long) %>% head()
bind_cols(dat, dat_long)
  
cbind(dat, dat_long2) %>% head()

# ---------------------------------------------

dat %>% left_join(dat_long2)
dat_long2 %>% 
  rename(grp2 = grp) %>% 
  left_join(dat, ., by = c("grp" = "grp2"))

```

```{r, eval=FALSE}

```
